<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    .editor {
      width: 100%;
      height: 300px;
      border: 1px solid #ccc;
      padding: 10px;
      overflow-y: auto;
    }
  </style>
  <body>
    <div
      contenteditable="true"
      id="editor"
      class="editor"
      placeholder="내용을 입력하세요..."
    ></div>
    <input
      type="file"
      id="imageInput"
      accept="image/*"
      onchange="insertImage()"
      multiple
    />
    <button id="submitButton" onclick="submitPost()">게시</button>
    <div id="image-show"></div>
    <script>
      function insertImage() {
        const imageInput = document.getElementById("imageInput");
        const editor = document.getElementById("editor");

        // 이미지 파일을 선택하지 않은 경우
        if (!imageInput.files || !imageInput.files[0]) {
          return;
        }

        const file = imageInput.files[0];
        const file1 = imageInput.files[1];
        const reader = new FileReader();

        reader.onload = function (event) {
          const imageUrl = event.target.result;

          // 이미지 태그를 생성하여 에디터에 삽입
          const imageTag = `<img src="${imageUrl}" alt="uploaded image" />`;
          insertHtmlAtCaret(imageTag);
        };

        reader.readAsDataURL(file);
      }

      function insertHtmlAtCaret(html) {
        const sel = window.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
          const range = sel.getRangeAt(0);
          range.deleteContents();

          const el = document.createElement("div");
          el.innerHTML = html;
          const frag = document.createDocumentFragment();
          let node;
          let lastNode;
          while ((node = el.firstChild)) {
            lastNode = frag.appendChild(node);
          }
          range.insertNode(frag);

          // Preserve the selection
          if (lastNode) {
            range = range.cloneRange();
            range.setStartAfter(lastNode);
            range.collapse(true);
            sel.removeAllRanges();
            sel.addRange(range);
          }
        }
      }

      function submitPost() {
        const editor = document.getElementById("editor");
        const content = editor.innerHTML;
        // 이제 이 content를 서버로 전송하거나 다른 처리를 수행할 수 있습니다.
        console.log(content);
      }
    </script>
  </body>
</html>
